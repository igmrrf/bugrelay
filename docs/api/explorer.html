<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BugRelay API Explorer</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.10.0/swagger-ui.css" />
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .api-explorer-header {
            background: #1e293b;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .api-explorer-header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .explorer-tabs {
            display: flex;
            gap: 1rem;
        }
        
        .tab-button {
            padding: 0.5rem 1rem;
            border: 1px solid #475569;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            background: #475569;
        }
        
        .tab-button.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }
        
        .explorer-content {
            height: calc(100vh - 80px);
            overflow: auto;
        }
        
        #swagger-ui {
            max-width: none;
        }
        
        #redoc-container {
            height: 100%;
        }
        
        .hidden {
            display: none;
        }
        
        /* Custom Swagger UI styling */
        .swagger-ui .topbar {
            display: none;
        }
        
        .swagger-ui .info {
            margin: 2rem 0;
        }
        
        .swagger-ui .scheme-container {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        /* Server selector styling */
        .server-selector {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 2rem;
        }
        
        .server-selector label {
            font-weight: 600;
            margin-right: 0.5rem;
        }
        
        .server-selector select {
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="api-explorer-header">
        <h1>BugRelay API Explorer</h1>
        <div class="explorer-tabs">
            <button class="tab-button active" onclick="switchTab('swagger')">Swagger UI</button>
            <button class="tab-button" onclick="switchTab('redoc')">ReDoc</button>
        </div>
    </div>
    
    <div class="server-selector">
        <label for="server-select">API Server:</label>
        <select id="server-select" onchange="updateServer()">
            <option value="http://localhost:8080">Development (localhost:8080)</option>
            <option value="https://api.bugrelay.com">Production (api.bugrelay.com)</option>
        </select>
    </div>
    
    <div class="explorer-content">
        <div id="swagger-container">
            <div id="swagger-ui"></div>
        </div>
        <div id="redoc-container" class="hidden"></div>
    </div>

    <script src="https://unpkg.com/swagger-ui-dist@5.10.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/redoc@2.1.3/bundles/redoc.standalone.js"></script>
    
    <script>
        let swaggerUI = null;
        let currentTab = 'swagger';
        let currentServer = 'http://localhost:8080';
        
        // Initialize Swagger UI
        function initSwaggerUI() {
            swaggerUI = SwaggerUIBundle({
                url: './openapi.yaml',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.presets.standalone
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                tryItOutEnabled: true,
                requestInterceptor: (request) => {
                    // Update the URL to use the selected server
                    if (request.url.startsWith('/')) {
                        request.url = currentServer + request.url;
                    }
                    return request;
                },
                onComplete: () => {
                    // Hide the server selector in Swagger UI since we have our own
                    const servers = document.querySelector('.swagger-ui .servers');
                    if (servers) {
                        servers.style.display = 'none';
                    }
                }
            });
        }
        
        // Initialize ReDoc
        function initRedoc() {
            Redoc.init('./openapi.yaml', {
                scrollYOffset: 80,
                theme: {
                    colors: {
                        primary: {
                            main: '#3b82f6'
                        }
                    },
                    typography: {
                        fontSize: '14px',
                        lineHeight: '1.5em',
                        code: {
                            fontSize: '13px'
                        }
                    }
                }
            }, document.getElementById('redoc-container'));
        }
        
        // Switch between tabs
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide content
            if (tab === 'swagger') {
                document.getElementById('swagger-container').classList.remove('hidden');
                document.getElementById('redoc-container').classList.add('hidden');
                if (!swaggerUI) {
                    initSwaggerUI();
                }
            } else if (tab === 'redoc') {
                document.getElementById('swagger-container').classList.add('hidden');
                document.getElementById('redoc-container').classList.remove('hidden');
                if (document.getElementById('redoc-container').innerHTML === '') {
                    initRedoc();
                }
            }
            
            currentTab = tab;
        }
        
        // Update server URL
        function updateServer() {
            currentServer = document.getElementById('server-select').value;
            
            // Reinitialize Swagger UI with new server
            if (currentTab === 'swagger' && swaggerUI) {
                initSwaggerUI();
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initSwaggerUI();
        });
        
        // Handle authentication
        function setAuthToken() {
            const token = prompt('Enter your JWT token:');
            if (token && swaggerUI) {
                swaggerUI.preauthorizeApiKey('BearerAuth', `Bearer ${token}`);
            }
        }
        
        // Add auth button to Swagger UI
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const authSection = document.querySelector('.swagger-ui .auth-wrapper');
                if (authSection) {
                    const authButton = document.createElement('button');
                    authButton.textContent = 'Set Auth Token';
                    authButton.className = 'btn authorize';
                    authButton.onclick = setAuthToken;
                    authSection.appendChild(authButton);
                }
            }, 2000);
        });
    </script>
</body>
</html>